<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->

<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lexis - Minimal, Corporate Bootstrap template</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/flexslider.css">
<link rel="stylesheet" href="css/jquery.fancybox.css">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/responsive.css">
<link rel="stylesheet" href="css/font-icon.css">
<link rel="stylesheet" href="css/animate.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<link rel="stylesheet" href="./styles/graph.css">
<script src="./js/rdflib.min.js"></script>
<script src="./js/FOAF.js"></script>
<script src="./js/graph.js"></script>
<script src="./js/utils.js"></script>
<!-- Google Analytics Script -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-105733990-2', 'auto');
  ga('send', 'pageview');

</script>
</head>

<body>
<!-- header section -->
<section class="foaftitle" role="foaftitle">
  <header id="header">
    <div class="header-content clearfix">
      <a class="logo" href="index.html">Home</a>
      <nav class="navigation" role="navigation">
        <ul class="primary-nav">
          <li><a href="#teams">INTEGRANTES</a></li>
          <li><a href="#foaf">ESTRUCTURA FOAF</a></li>
          <li><a href="#academic">EJEMPLO DE INDIVIDUOS FOAF</a></li>
          <li><a href="#production">FOAF EN PRODUCCIÓN</a></li>
        </ul>
      </nav>
      <a href="#" class="nav-toggle">Menu<span></span></a> </div>
  </header>
  <!-- banner text -->
  <div class="container">
    <div class="col-md-10 col-md-offset-1">
      <div class="banner-text text-center">
        <h1>TRABAJO DE INGENIERÍA Y GESTIÓN DEL CONOCIMIENTO</h1>
        <br>
        <br>
        <h1>Grupo 2</h1>
      <!-- banner text -->
    </div>
  </div>
</section>
<!-- header section -->

<!-- our team section -->
<section id="teams" class="section teams">
  <div class="container">
    <div class="row">
      <div class="col-md-3 col-sm-6">
        <div class="person"><img src="images/team-1.jpg" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Daniel Carbajal</h4>
            <h5 class="role">TheBackEndMan</h5>
          </div>
          <ul class="social-icons clearfix">
          </ul>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="person"> <img src="images/team-2.jpg" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Erasmo Gómez</h4>
            <h5 class="role">SimeplementeErasmo</h5>
          </div>
          <ul class="social-icons clearfix">
          </ul>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="person"> <img src="images/team-3.jpg" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Diego Salas</h4>
            <h5 class="role">Topo</h5>
          </div>
          <ul class="social-icons clearfix">
          </ul>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="person"> <img src="images/team-4.jpg" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Rodolfo Gálvez</h4>
            <h5 class="role">Rodo</h5>
          </div>
          <ul class="social-icons clearfix">
          </ul>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="person"> <img src="images/team-5.jpg" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Rodrigo Maldonado</h4>
            <h5 class="role">TheCid</h5>
          </div>
          <ul class="social-icons clearfix">
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- our team section -->

<!-- foaf section -->
<section id="foaf" class="foaf">
    <h2>Estructura Friend of a Friend</h2>
    <div class="embed-container">
        <iframe width="560" height="315" src="http://visualdataweb.de/webvowl/" marginwidth="50" frameborder="0" allowfullscreen></iframe>
    </div>
</section>
<!-- foaf section -->

<!-- academic section -->
<section id="academic" class="services service-section">
  <div class="container">
    <div class="row">
      <div class="row col-sm-12">
        <div class="col-sm-4">
             <form id="CreatePersonForm">
                <div class="form-group">
                    <label for="PersonGivenName">Person Given Name:</label>
                    <input type="text" class="form-control" id="PersonGivenName">
                </div>
                <div class="form-group">
                    <label for="PersonFamilyName">Person Family Name:</label>
                    <input type="text" class="form-control" id="PersonFamilyName">
                </div>
                <div class="form-group">
                    <label for="PersonNick">Person Nick:</label>
                    <input type="text" class="form-control" id="PersonNick">
                </div>
                <div class="form-group">
                    <label for="PersonHomepage">Person Homepage:</label>
                    <input type="text" class="form-control" id="PersonHomepage">
                </div>
                <button type="submit" class="btn btn-default">Add Person</button>
            </form>
        </div>
        <div class="col-sm-4">
             <form id="CreateKnowRelationForm">
                <div class="form-group">
                    <label for="FirstPerson">First Person:</label>
                    <input type="text" class="form-control" id="FirstPerson">
                </div>
                <div class="form-group">
                    <label for="SecondPerson">First Person:</label>
                    <input type="text" class="form-control" id="SecondPerson">
                </div>
                <button type="submit" class="btn btn-default">Create Connection</button>
            </form>
        </div>
        <div class="col-sm-4">
             <form id="CreatePersonForm2">
                <div class="form-group">
                    <label for="PersonFile">Person File:</label>
                    <input type="file" class="form-control" id="PersonFile">
                </div>
                <button type="submit" class="btn btn-default">Upload Persons</button>
            </form>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- academic section -->
<section id="production" class="services service-section">
  <div class="container">
    <div class="row">
      <div class="row col-sm-12">
        <div class="col-sm-6">
            <pre class = "doc1" id="DocumentContent" style="margin-top: 24px;"></pre>
            <form id="DownloadXmlForm">
                <button type="submit" class="btn btn-default">Download</button>
            </form>
        </div>
        <div class="col-sm-6">
            <div id="svg-body" class="panel-body" style="margin-top: 8px;"></div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Footer section -->
<footer class="footer" align="center" >
  <div class="footer-top section">
    <div class="container"  align="center">
          <h5>Trabajo de Ingeniería y Gestión del Conocimiento</h5>
          <p>Maestría en Informática 2017-2</p>
          <p>Pontifia Universidad del Perú</p>
    </div>
  </div>
</footer>
<script>
    var svg = d3.select("#svg-body")
                .append("svg")
				.attr("width", 600)
				.attr("height", 300);
	  var force = d3.layout.force().size([600, 300]);
    var graph;
    var triples;
    var store = $rdf.graph()
    triples = [];
    var personHash = "";

    $('#CreateKnowRelationForm').submit(function( event ) {
        AddFoafKnowToD3();
        AddFOAFKnowToXML();
        updateRDFGraphs();
        event.preventDefault();
    });
    $('#CreatePersonForm').submit(function( event ) {
        personHash = getHashId(5);
        AddFoafKnowToD32();
        AddFOAFKnowToXML2();
        updateRDFGraphs();
        event.preventDefault();
    });
    $('#CreatePersonForm2').submit(function( event ) {
		ReadFile();
        //AddFoafPersonToD3("Diego");
        //AddFOAFKnowToXML();
        //updateRDFGraphs();
        event.preventDefault();
    });
    $('#DownloadXmlForm').submit(function( event ) {
		$rdf.serialize(undefined, store, undefined, 'application/rdf+xml', function(err, str) {
        	download("my_foaf_document.rdf",str);
        });
        event.preventDefault();
    });
    function AddFoafKnowToD3(){
        var firtsPersonName  = $('#FirstPerson').val();
        var secondPersonName = $('#SecondPerson').val();
        var firtsPerson = FOAF.PERSON(firtsPersonName);
        var secondPerson = FOAF.PERSON(secondPersonName);
        var triple = new Triple();
        triple.subject = firtsPerson.value;
        triple.predicate = FOAF.KNOWS.value;
        triple.object = secondPerson.value;
        triples.push(triple);
        triple = new Triple();
        triple.subject = firtsPerson.value;
        triple.predicate = FOAF.NAME.value;
        triple.object = firtsPersonName
        triples.push(triple);
        triple = new Triple();
        triple.subject = secondPerson.value;
        triple.predicate = FOAF.NAME.value;
        triple.object = secondPersonName
        triples.push(triple);
    }


    function AddFoafKnowToD32(){
        var personGivenName  = $('#PersonGivenName').val();
        var personFamilyName  = $('#PersonFamilyName').val();
        var personName  = personGivenName + " " + personFamilyName;//$('#PersonName').val();
        var personHomepage = $('#PersonHomepage').val();
        var personNick = $('#PersonNick').val();
        var firtsPerson = FOAF.PERSON(personGivenName + "_" + personHash);
        triple = new Triple();
        triple.subject = firtsPerson.value;
        triple.predicate = FOAF.NAME.value;
        triple.object = personName
        triples.push(triple);
        triple = new Triple();
        triple.subject = firtsPerson.value;
        triple.predicate = FOAF.GIVEN_NAME.value;
        triple.object = personGivenName
        triples.push(triple);
        triple = new Triple();
        triple.subject = firtsPerson.value;
        triple.predicate = FOAF.FAMILY_NAME.value;
        triple.object = personFamilyName
        triples.push(triple);
        triple = new Triple();
        triple.subject = firtsPerson.value;
        triple.predicate = FOAF.HOME_PAGE.value;
        triple.object = personHomepage
        triples.push(triple);
        triple = new Triple();
        triple.subject = firtsPerson.value;
        triple.predicate = FOAF.NICK.value;
        triple.object = personNick
        triples.push(triple);
    }

    function AddFOAFKnowToXML(){
        var firtsPersonName  = $('#FirstPerson').val();
        var secondPersonName = $('#SecondPerson').val();
        var firtsPerson = FOAF.PERSON(firtsPersonName);
        var secondPerson = FOAF.PERSON(secondPersonName);
        store.add(firtsPerson, FOAF.NAME, FOAF.STRING(firtsPersonName));
        store.add(secondPerson, FOAF.NAME, FOAF.STRING(secondPersonName));
        store.add(firtsPerson,FOAF.KNOWS,secondPerson);
    }

    function AddFOAFKnowToXML2(){
        var personGivenName  = $('#PersonGivenName').val();
        var personFamilyName  = $('#PersonFamilyName').val();
        var personName  = personGivenName + " " + personFamilyName;
        var personHomepage = $('#PersonHomepage').val();
        var personNick = $('#PersonNick').val();
        var person = FOAF.PERSON(personGivenName + "_" + personHash);
        store.add(person, FOAF.NAME, FOAF.STRING(personName));
        store.add(person, FOAF.GIVEN_NAME, FOAF.STRING(personGivenName));
        store.add(person, FOAF.FAMILY_NAME, FOAF.STRING(personFamilyName));
        store.add(person, FOAF.HOME_PAGE, FOAF.STRING(personHomepage));
        store.add(person, FOAF.NICK, FOAF.STRING(personNick));
    }

    function AddFOAFPersonToXML3(person){
        var personGivenName  = person.GivenName;
        var personFamilyName  = person.FamilyName;
        var personName  = personGivenName + " " + personFamilyName;
        var personHomepage = person.Homepage;
        var personNick = person.Nick;
        var person = FOAF.PERSON(person.Id);
        store.add(person, FOAF.NAME, FOAF.STRING(personName));
        store.add(person, FOAF.GIVEN_NAME, FOAF.STRING(personGivenName));
        store.add(person, FOAF.FAMILY_NAME, FOAF.STRING(personFamilyName));
        store.add(person, FOAF.HOME_PAGE, FOAF.STRING(personHomepage));
        store.add(person, FOAF.NICK, FOAF.STRING(personNick));
    }

    function updateRDFGraphs(){
        $rdf.serialize(undefined, store, undefined, 'application/rdf+xml', function(err, str) {
            $('#DocumentContent').text(str);
        });
        graph = triplesToGraph(triples);
        update();
    }

    function Triple(){
        this.subject="";
        this.predicate="";
        this.object="";
        return this;
    }
    function ReadFile() {
  	    var fileInput = document.getElementById("PersonFile");
          var reader = new FileReader();
          reader.onload = function () {
          	var csv = event.target.result;
        		var data = processData(csv);
        		$(data).each(function(index,elem){
  				//console.log(elem);
          elem.Id = elem.Id + "_" + elem.GivenName + "_" + getHashId(5);
  				AddFoafPersonToD33(elem);
  				AddFOAFPersonToXML3(elem);
        		});
        		updateRDFGraphs();
          };
          // start reading the file. When it is done, calls the onload event defined above.
          reader.readAsBinaryString(fileInput.files[0]);
  	}

  	function processData(csv) {
          var allTextLines = csv.split(/\r\n|\n/);
          var people = [];
          var headers = [];
          for (var i=0; i<allTextLines.length; i++) {
          	if (i == 0) {
          		headers = allTextLines[i].split(',');
          		continue;
          	}
              var data = allTextLines[i].split(',');
              var tarr = [];
              var obj = {};
              for (var j=0; j<data.length; j++) {
              	var index = headers[j];
                  obj[index] = data[j];
              }
              people.push(obj);
          }
        	return people;
      }

      function AddFoafPersonToD33(person){
          var personGivenName  = person.GivenName
          var personFamilyName  = person.FamilyName
          var personName  = personGivenName + " " + personFamilyName;
          var personHomepage = person.Homepage;
          var personNick = person.Nick;
          var firtsPerson = FOAF.PERSON(person.Id);
          triple = new Triple();
          triple.subject = firtsPerson.value;
          triple.predicate = FOAF.NAME.value;
          triple.object = personName;
          triples.push(triple);
          triple = new Triple();
          triple.subject = firtsPerson.value;
          triple.predicate = FOAF.GIVEN_NAME.value;
          triple.object = personGivenName;
          triples.push(triple);
          triple = new Triple();
          triple.subject = firtsPerson.value;
          triple.predicate = FOAF.FAMILY_NAME.value;
          triple.object = personFamilyName;
          triples.push(triple);
          triple = new Triple();
          triple.subject = firtsPerson.value;
          triple.predicate = FOAF.HOME_PAGE.value;
          triple.object = personHomepage;
          triples.push(triple);
          triple = new Triple();
          triple.subject = firtsPerson.value;
          triple.predicate = FOAF.NICK.value;
          triple.object = personNick;
          triples.push(triple);
      }

</script>
<!-- Footer section -->
<!-- JS FILES -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.flexslider-min.js"></script>
<script src="js/jquery.fancybox.pack.js"></script>
<script src="js/retina.min.js"></script>
<script src="js/modernizr.js"></script>
<script src="js/main.js"></script>
<script type="text/javascript" src="js/jquery.contact.js"></script>
</body>
</html>
